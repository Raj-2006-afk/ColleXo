<!-- Submissions Table -->
<div class="card">
    <div class="card-body" style="padding: 2rem;">
        <h3>Submissions</h3>
        
        {% if submissions.items %}
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Submitted</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for response in submissions.items %}
                    <tr>
                        <td>{{ loop.index + (submissions.page - 1) * submissions.per_page }}</td>
                        <td><strong>{{ response.submitter_name }}</strong></td>
                        <td>{{ response.submitter_email }}</td>
                        <td>{{ response.submitter_phone or 'N/A' }}</td>
                        <td>{{ response.created_at.strftime('%b %d, %Y %I:%M %p') }}</td>
                        <td>
                            <button type="button" 
                                    class="btn btn-sm btn-primary" 
                                    data-response-id="{{ response.id }}"
                                    data-response-data='{{ response.to_dict()|tojson }}'
                                    onclick="viewSubmissionData(this)">
                                View Details
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Pagination -->
        {% if submissions.pages > 1 %}
        <nav>
            <ul class="pagination">
                {% if submissions.has_prev %}
                <li class="page-item">
                    <a class="page-link" href="{{ url_for('societies.view_form', form_id=form.id, page=submissions.prev_num) }}">Previous</a>
                </li>
                {% endif %}
                
                {% for page_num in submissions.iter_pages() %}
                    {% if page_num %}
                        <li class="page-item {% if page_num == submissions.page %}active{% endif %}">
                            <a class="page-link" href="{{ url_for('societies.view_form', form_id=form.id, page=page_num) }}">{{ page_num }}</a>
                        </li>
                    {% endif %}
                {% endfor %}
                
                {% if submissions.has_next %}
                <li class="page-item">
                    <a class="page-link" href="{{ url_for('societies.view_form', form_id=form.id, page=submissions.next_num) }}">Next</a>
                </li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}
        
        {% else %}
        <p class="text-muted text-center" style="padding: 2rem 0;">No submissions yet.</p>
        {% endif %}
    </div>
</div>

<!-- Modal for viewing submission details -->
<div id="submissionModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999;">
    <div style="background: white; max-width: 800px; margin: 50px auto; padding: 2rem; border-radius: 12px; max-height: 80vh; overflow-y: auto;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h3>Submission Details</h3>
            <button onclick="closeModal()" class="btn btn-secondary">Close</button>
        </div>
        <div id="submissionContent"></div>
    </div>
</div>

<script>
function viewSubmissionData(button) {
    const id = button.getAttribute('data-response-id');
    const data = JSON.parse(button.getAttribute('data-response-data'));
    viewSubmission(id, data);
}

function viewSubmission(id, data) {
    const content = document.getElementById('submissionContent');
    let html = '<div class="table-responsive"><table class="table">';
    
    html += `<tr><th>Submitter Name:</th><td>${data.submitter_name}</td></tr>`;
    html += `<tr><th>Email:</th><td>${data.submitter_email}</td></tr>`;
    html += `<tr><th>Phone:</th><td>${data.submitter_phone || 'N/A'}</td></tr>`;
    html += `<tr><th>Submitted At:</th><td>${new Date(data.created_at).toLocaleString()}</td></tr>`;
    html += '<tr><td colspan="2"><hr></td></tr>';
    
    for (const [key, value] of Object.entries(data.submission_data)) {
        const displayValue = Array.isArray(value) ? value.join(', ') : value;
        html += `<tr><th>${key}:</th><td>${displayValue}</td></tr>`;
    }
    
    html += '</table></div>';
    content.innerHTML = html;
    document.getElementById('submissionModal').style.display = 'block';
}

function closeModal() {
    document.getElementById('submissionModal').style.display = 'none';
}

// Close modal when clicking outside
document.getElementById('submissionModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeModal();
    }
});
</script>
