{% extends "base.html" %} {% block title %}Login - ColleXo{% endblock %} {%
block content %}
<div class="auth-container">
	<div class="auth-card">
		<h2>Login to ColleXo</h2>
		<form id="loginForm">
			<div class="form-group">
				<label for="email">Email</label>
				<input
					type="email"
					id="email"
					name="email"
					required
					placeholder="your.email@college.edu"
				/>
			</div>

			<div class="form-group">
				<label for="password">Password</label>
				<input
					type="password"
					id="password"
					name="password"
					required
					placeholder="Enter your password"
				/>
			</div>

			<div class="form-group">
				<button type="submit" class="btn btn-primary">Login</button>
			</div>

			<div class="form-footer">
				<p>Don't have an account? <a href="/register">Register here</a></p>
			</div>
		</form>

		<div id="message" class="message" style="display: none"></div>
	</div>
</div>

<script>
	document.getElementById("loginForm").addEventListener("submit", async (e) => {
		e.preventDefault();

		const email = document.getElementById("email").value;
		const password = document.getElementById("password").value;
		const messageDiv = document.getElementById("message");

		try {
			const response = await fetch("/api/auth/login", {
				method: "POST",
				headers: {
					"Content-Type": "application/json",
				},
				body: JSON.stringify({
					user_email: email,
					user_password: password,
				}),
			});

			const data = await response.json();

			if (response.ok) {
				// Store token and user info
				localStorage.setItem("token", data.access_token);
				localStorage.setItem("user", JSON.stringify(data.user));

				// Show success message
				messageDiv.textContent = "Login successful! Redirecting...";
				messageDiv.className = "message success";
				messageDiv.style.display = "block";

				// Redirect based on role
				setTimeout(() => {
					if (data.user.user_role === "admin") {
						window.location.href = "/admin/dashboard";
					} else if (data.user.user_role === "societyHead") {
						window.location.href = "/society/dashboard";
					} else {
						window.location.href = "/student/dashboard";
					}
				}, 1000);
			} else {
				messageDiv.textContent = data.error || "Login failed";
				messageDiv.className = "message error";
				messageDiv.style.display = "block";
			}
		} catch (error) {
			messageDiv.textContent = "Network error. Please try again.";
			messageDiv.className = "message error";
			messageDiv.style.display = "block";
		}
	});
</script>
{% endblock %}
